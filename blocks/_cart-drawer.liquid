<button
  x-data="{ active: {% if request.path == '{{ routes.cart_url }}' %}true{% else %}false{% endif %} }"
  @window:navigation.window="active = location.pathname === '{{ routes.cart_url }}'"
  onclick="document.getElementById('cart_drawer')?.showModal()"
  :class="active ? 'underline' : ''"
  class="button"
>
  Cart ({% render 'cart-amount' %})
</button>

<dialog scroll-lock id="cart_drawer" closedby="any" class="max-h-none h-screen left-auto right-0">
  <div class="grid h-screen top-0 grid-rows-[auto_1fr] pb-4 w-md max-w-screen bg-white text-sm">
    <header class="mx-4 flex h-10 items-center justify-between border-b border-gray-300">
      <p class="text-xs uppercase">Your cart ({% render 'cart-amount' %})</p>

      <button onclick="this.closest('dialog')?.close()" aria-label="Close cart drawer" class="button size-5">
        {% render 'icon-cross' %}
      </button>
    </header>

    {% content_for 'block', type: '_cart-form', id: 'cart_drawer_form' %}

    {% unless cart == empty %}
      <footer class="mb-2 mt-4 justify-self-center text-center">
        <a href="{{ routes.cart_url }}" class="button inline-block"> Go to cart </a>
      </footer>
    {% endunless %}
  </div>
</dialog>

{% stylesheet %}
  dialog#cart_drawer[open] {
    transform: translateX(0);
  }

  dialog#cart_drawer {
    --ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);

    transform: translateX(100%);
    transition: all 500ms var(--ease-in-out) allow-discrete;
  }

  @starting-style {
    dialog#cart_drawer[open] {
      transform: translateX(100%);
    }
  }

  dialog#cart_drawer::backdrop {
    background-color: transparent;
    transition: all 500ms var(--ease-in-out) allow-discrete;
  }

  dialog#cart_drawer[open]::backdrop {
    background-color: rgb(0 0 0 / 25%);
  }

  @starting-style {
    dialog#cart_drawer[open]::backdrop {
      background-color: transparent;
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Cart drawer",
  "presets": [
    {
      "name": "Cart drawer",
      "category": "Secondary menu"
    }
  ]
}
{% endschema %}
