<button id="localization_button" class="button" onclick="document.getElementById('localization_form')?.showModal()">
  {{ localization.language.iso_code }} / {{ localization.country.currency.symbol }}
</button>

<dialog id="localization_form" closedby="any" class="top-1/3 left-1/2 w-full max-w-md -translate-1/2 rounded-lg">
  {% form 'localization', x-target: 'content_for_layout localization_button cart cart_form' %}
    <div class="p-5 text-xs tracking-wider uppercase">
      <header class="flex items-center justify-between">
        <h1 class="text-gray-500">Shop in your local currency</h1>

        <button type="button" aria-label="Close modal" class="button w-4" onclick="this.closest('dialog')?.close()">
          {% render 'icon-cross' %}
        </button>
      </header>

      <div class="my-4 flex items-center gap-4 border-t border-t-gray-200 pt-4">
        <p class="text-gray-400">Language</p>

        {% if localization.available_languages.size > 1 %}
          <select
            class="button"
            name="country_code"
            onchange="this.closest('dialog')?.close(); this.closest('form').requestSubmit()"
          >
            {% for language in localization.available_languages %}
              <option
                {% if language.iso_code == localization.language.iso_code %}
                  aria-current="true"
                  selected
                {% endif %}
                value="{{ language.iso_code }}"
              >
                {{ language.name }} ({{ language.iso_code }})
              </option>
            {% endfor %}
          </select>
        {% else %}
          <p class="text-gray-500">{{ localization.language.name }}</p>
        {% endif %}
      </div>

      <div class="my-4 flex items-center gap-4 border-t border-t-gray-200 pt-4">
        <p class="text-gray-400">Currency</p>

        {% if localization.available_countries.size > 1 %}
          {% assign printed_currencies = '' %}

          <select
            class="button"
            name="country_code"
            onchange="this.closest('dialog')?.close(); this.closest('form').requestSubmit()"
          >
            {% for country in localization.available_countries %}
              {% unless printed_currencies contains country.currency.name %}
                <option
                  {% if country.iso_code == localization.country.iso_code %}
                    aria-current="true"
                    selected
                  {% endif %}
                  value="{{ country.iso_code }}"
                >
                  {{ country.currency.iso_code }}
                  ({{ country.currency.symbol }})
                </option>

                {% assign printed_currencies = printed_currencies | append: ';' | append: country.currency.name %}
              {% endunless %}
            {% endfor %}
          </select>
        {% else %}
          <p class="text-gray-500">
            {{ localization.country.currency.iso_code }}
            ({{ localization.country.currency.symbol }})
          </p>
        {% endif %}
      </div>
    </div>

    <input
      x-data="{ currentPath: window.location.pathname }"
      @window:navigation.window="currentPath = window.location.pathname"
      type="hidden"
      name="return_to"
      :value="currentPath"
    >
  {% endform %}
</dialog>

{% stylesheet %}
  dialog#localization_form[open] {
    transform: translateY(0);
    opacity: 1;
  }

  dialog#localization_form {
    --ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);

    transform: translateY(0.5rem);
    opacity: 0;
    transition: all 200ms var(--ease-in-out) allow-discrete;
  }

  @starting-style {
    dialog#localization_form[open] {
      transform: translateY(0.5rem);
      opacity: 0;
    }
  }

  dialog#localization_form::backdrop {
    background-color: transparent;
    transition: all 200ms var(--ease-in-out) allow-discrete;
  }

  dialog#localization_form[open]::backdrop {
    background-color: rgb(0 0 0 / 25%);
  }

  @starting-style {
    dialog#localization_form[open]::backdrop {
      background-color: transparent;
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Localization form",
  "presets": [
    {
      "name": "Localization form"
    }
  ]
}
{% endschema %}
