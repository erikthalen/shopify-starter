<section class="px-4 my-20">
  <h1 class="text-3xl mb-4">{{ section.settings.title }}</h1>

  <form x-data="cart" action="{{ routes.cart_url }}" method="post" class="grid gap-6">
    {%- if cart == empty -%}
      Your cart is empty
    {% else %}
      {%- for item in cart.items -%}
        <div style="view-transition-name: item-{{ item.variant_id }}" class="grid grid-cols-2 bg-gray-50 rounded-lg overflow-clip border border-gray-200">
          {% if item.image %}
            {% render 'image', image: item.image %}
          {%- endif -%}

          <div class="p-4 flex flex-col">
            <div class="flex justify-between">
              <a class="font-bold text-blue-500 text-lg" href="{{ item.url }}">{{ item.product.title | escape }}</a>
              
              <div class="text-2xl">
                {%- if item.original_price != item.final_price -%}
                  <p>Original price: {{ item.original_price | money -}}</p>
                  <p>Final price: {{ item.final_price | money -}}</p>
                {%- else -%}
                  <p>Price: {{ item.original_price | money }}</p>
                {%- endif -%}
              </div>
            </div>

            <dl>
              {%- if item.product.has_only_default_variant == false -%}
                {%- for option in item.options_with_values -%}
                  <dt class="font-bold">{{ option.name }}:</dt>
                  <dd>{{ option.value }}</dd>
                {%- endfor -%}
              {%- endif -%}

              {%- for property in item.properties -%}
                {%- assign property_first_char = property.first | slice: 0 -%}
                {%- if property.last != blank and property_first_char != '_' -%}
                  <dt class="font-bold">{{ property.first }}:</dt>
                  <dd>
                    {%- if property.last contains '/uploads/' -%}
                      <a href="{{ property.last }}" class="link" target="_blank">
                        {{ property.last | split: '/' | last }}
                      </a>
                    {%- else -%}
                      {{ property.last }}
                    {%- endif -%}
                  </dd>
                {%- endif -%}
              {%- endfor -%}
            </dl>

            {{ item.selling_plan_allocation.selling_plan.name }}

            {%- for discount in item.line_level_discount_allocations -%}
              {{ discount.discount_application.title }}
            {%- endfor -%}

            <div class="mt-auto">  
              <div class="text-2xl my-4">

                {%- if item.original_line_price != item.final_line_price -%}
                  <p>Total original price: {{ item.original_line_price | money }}</p>
                  <p>Total final price: {{ item.final_line_price | money }}</p>
                {%- else -%}
                  <p>Total price: {{ item.original_line_price | money }}</p>
              {%- endif -%}
              
              {%- if item.variant.available and item.unit_price_measurement -%}
                {{ item.unit_price | money }}
                
                {%- if item.unit_price_measurement.reference_value != 1 -%}
                  {{- item.unit_price_measurement.reference_value -}}
                {%- endif -%}
                
                {{ item.unit_price_measurement.reference_unit }}
              {%- endif -%}
            </div>
              
              <a
                @click.prevent="handleRemove"
                data-barba-prevent
                class="bg-blue-400 text-white py-1 px-2 rounded"
                href="{{ item.url_to_remove }}"
              >
                Remove
              </a>
              
              <input
                @change.prevent="handleQuantityChange"
                class="border py-1 px-2 rounded-sm"
                type="number"
                name="updates[]"
                value="{{ item.quantity }}"
                id="{{ item.variant.id }}"
                min="0"
              >
            </div>
          </div>
        </div>
        
      {%- endfor -%}
    {%- endif -%}
    
    <p class="my-4 text-3xl">Total:</p>
  
    <p class="text-5xl font-bold">{{ cart.total_price | money_with_currency }}</p>
  
    <button
      class="my-4 bg-blue-400 text-white py-1 px-2 rounded"
      type="submit"
      name="checkout"
      {% if cart == empty %}
        disabled
      {% endif %}
      form="cart"
    >
      Checkout
    </button>
  </form>

</section>

{% schema %}
{
  "name": "Main cart",
  "class": "main-cart",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Cart"
    }
  ]
}
{% endschema %}
